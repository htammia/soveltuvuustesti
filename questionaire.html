<!DOCTYPE html>
<html lang="fi">
  <head>
    <title>Soveltuvuustesti</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta charset="UTF-8">
    <link rel="stylesheet" href="style.css"> <!--style.css-->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" /> <!--Takaisin-napin nuoli-->
    <script type="text/javascript" src="questions.js"></script>
  </head>
  <body>
    <div class="questions-yla"><button id="back" class="material-symbols-outlined">arrow_back</button>
       <p class="question-title">ICT-alan soveltuvuustesti</p></div>
    
    <div class="question-container" id="questions">
      <h2 id="question" class="question">Question here</h2>
      <div class="options">
        <ul>
          <li>
            <input type="radio" name="option" id="a" class="option">
            <label for="a" id="a_text">Option a</label>
          </li>
          <li>
            <input type="radio" name="option" id="b" class="option">
            <label for="b" id="b_text">Option b</label>
          </li>
          <li>
            <input type="radio" name="option" id="c" class="option">
            <label for="c" id="c_text">Option c</label>
          </li>
          <li id="option_d">
            <input type="radio" name="option" id="d" class="option">
            <label for="d" id="d_text">Option d</label>
          </li>
        </ul>
      </div>
      <button id="next" class="isonappi">Seuraava</button>
    </div>
    

    <script>
      
      /* linking the HTML elements to variables */
      const questionnaire = document.getElementById("questions");
      const optionElements = document.querySelectorAll(".option");
      const questionElement = document.getElementById("question")

      /* the option texts */
      const a_text = document.getElementById("a_text");
      const b_text = document.getElementById("b_text");
      const c_text = document.getElementById("c_text");
      const d_text = document.getElementById("d_text");

      /* the buttons */
      const backButton = document.getElementById("back");
      const nextButton = document.getElementById("next");

      //the index of the current question visible
      let currentQuestion = 0;
      let userChoices = [];

      const points = {
        TT:0,
        ETT:0,
        TOL:0
      };

      loadQuestion();

      function loadQuestion() {
        console.log(currentQuestion + " / " + questionData.length);
        unSelectAll();
        const data = questionData[currentQuestion];
        questionElement.innerHTML = data.question;
        a_text.innerHTML = data.a;
        b_text.innerHTML = data.b;
        c_text.innerHTML = data.c;
        if (data.d != "none") {
          d_text.innerHTML = data.d;
          document.getElementById("option_d").style.display = "inherit";
        } else {
          document.getElementById("option_d").style.display = "none";
        }
      }

      function getSelected() {
        let answer;
        optionElements.forEach(function (optionElem){
          if (optionElem.checked) {
            answer = optionElem.id;
          }
        });
        return answer
      }

      function unSelectAll() {
        optionElements.forEach(function (optionElem){
          optionElem.checked = false
        });
      }

      function calculatePoints() {

        for (let i = 0; i < userChoices.length; i++) {
          if (userChoices[i] == "a") {
            if (pointsToTT[i].a) {
              points.TT++;
            }
            if (pointsToETT[i].a) {
              points.ETT++;
            }
            if (pointsToTOL[i].a) {
              points.TOL++;
            }
          }
            if (userChoices[i] == "b") {
            if (pointsToTT[i].b) {
              points.TT++;
            }
            if (pointsToETT[i].b) {
              points.ETT++;
            }
            if (pointsToTOL[i].b) {
              points.TOL++;
            }
          }
            if (userChoices[i] == "c") {
            if (pointsToTT[i].c) {
              points.TT++;
            }
            if (pointsToETT[i].c) {
              points.ETT++;
            }
            if (pointsToTOL[i].c) {
              points.TOL++;
            }
          }
          if (userChoices[i] == "d") {
            if (pointsToTT[i].d) {
              points.TT++;
            }
            if (pointsToETT[i].d) {
              points.ETT++;
            }
            if (pointsToTOL[i].d) {
              points.TOL++;
            }
          }
        }
        console.log("POINTS: tt: " + points.TT);
        console.log("POINTS: ett: " + points.ETT);
        console.log("POINTS: tol: " + points.TOL);
      }

      nextButton.addEventListener("click", () => {
        const answer = getSelected()
        //check if an option was chosen
        if (answer) {
          userChoices[currentQuestion] = answer;
          
          //increment to next question
          currentQuestion++;
          //check if more questions remain
          if (currentQuestion == questionData.length-1 ) {
            nextButton.innerHTML = "Tuloksiin!";
            loadQuestion();
          } else if (currentQuestion < questionData.length) {
            loadQuestion();
          } else {
            calculatePoints();
            window.location="results.html";
          }
        }
      })

      backButton.addEventListener("click", () => {
        if(currentQuestion > 0){
          currentQuestion--;
          loadQuestion();
        }
        else{
          document.location = "index.html";
        }
      })
      
    </script>

    <script> 

      /*Changes the options background to purple when it is clicked */
      const options = document.querySelectorAll('.option');
      const lis = document.querySelectorAll('.options li');

      for (let i = 0; i < options.length; i++) {
        options[i].addEventListener('click', function() {
          for (let j = 0; j < lis.length; j++) {
            lis[j].style.backgroundColor = '';
          }
          const selectedOption = document.querySelector('input[name="option"]:checked');
          const selectedLi = selectedOption.parentNode;
          selectedLi.style.backgroundColor = '#7A4FC7';
        });
      }

      /*When clicking next-button, options background is returned to default in next question*/
      nextButton.addEventListener("click", function() {
        lis.forEach(function(option) {
        option.style.backgroundColor = "";
        });
      });

      /*When clicking back-button, options background is returned to default in previous question*/
      backButton.addEventListener("click", function() {
        lis.forEach(function(option) {
        option.style.backgroundColor = "";
        });
      });

    </script>
  </body>
</html>